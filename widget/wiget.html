<style>
        #foucus_day {
            margin: 0 auto;
            width: 100%;
            max-width: 400px;
            height: 100px;
            max-height: 100%;
            background: #000;
            border-radius: 5px;
            padding: 12px 0px;
            -moz-user-select: none;
            /*ç«ç‹*/
            -webkit-user-select: none;
            /*webkitæµè§ˆå™¨*/
            -ms-user-select: none;
            /*IE10*/
            -khtml-user-select: none;
            /*æ—©æœŸæµè§ˆå™¨*/
            user-select: none;
            position: relative;
            transition: height 0.3s ease;
        }

        /* å‘¨è§†å›¾æ¨¡å¼ä¸‹çš„é«˜åº¦ - åŠ¨æ€è®¡ç®— */
        #foucus_day.week-view {
            /* é«˜åº¦å°†é€šè¿‡JavaScriptåŠ¨æ€è®¾ç½® */
            transition: height 0.3s ease;
        }

        /* ç¡®ä¿footeråœ¨åº•éƒ¨ä¸”æ²¡æœ‰è¿‡å¤šç©ºç™½ */
        .week-view .footer {
            position: absolute;
            bottom: 10px;
            width: 100%;
            font-size: 12px;
        }

        .head_title {
            color: #D0D0D0;
            text-align: center;
            font-size: 14px;
            margin-right: 20px;
        }

        .toggle-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: #333;
            color: #D0D0D0;
            border: none;
            border-radius: 4px;
            padding: 2px 5px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-btn:hover {
            background: #444;
            color: #fff;
        }

        .HStack {
            display: flex;
            margin-top: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .metricBlock {
            flex: 1;
            text-align: center;
            margin: 5px 2px;
        }

        /* å‘¨è§†å›¾æ¨¡å¼ä¸‹çš„æŒ‡æ ‡å—æ ·å¼ */
        .week-view .metricBlock {
            flex: 0 0 calc(33.33% - 10px);
            margin-bottom: 10px;
        }

        .metricBlock .title {
            color: #D0D0D0;
            font-size: 12px;

        }

        .metricBlock .value {
            color: #ffffff;
            font-weight: bold;
            font-size: 12px;
            padding: 3px 0;
        }

        .metricBlock .sub_value {
            font-size: 12px;
        }

        /* å‘¨è§†å›¾æ¨¡å¼ä¸‹çš„å€¼æ ·å¼ */
        .week-view .metricBlock .value {
            font-size: 12px;
        }

        .metricBlock .sub_value {
            color: red;
        }

        #foucus_day .footer {
            color: #323232;
            text-align: center;
            font-size: 12px;
        }

        /*éª¨æ¶å±*/
        @-webkit-keyframes skeleton-ani {
            to {
                background-position: 350% 0;
            }
        }

        @keyframes skeleton-ani {
            to {
                background-position: 350% 0;
            }
        } 


        .skt-loading .skeleton {
            position: relative;
            overflow: hidden;
            border: none !important;
            border-radius: 5px;
            background-color: rgba(0, 0, 0, 0) !important;
            background-image: none !important;
            pointer-events: none;
        }

        .skt-loading .skeleton:after {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            z-index: 9;
            width: 100%;
            height: 100%;
            /*background-color: #ebf1f8;*/
            background-color: #f9f9f9;
            display: block
        }

        .skt-loading .skeleton:not(.not-round):after {
            border-radius: 4px
        }

        .format_time {
            display: inline;
        }

        #foucus_day.skt-loading .skeleton:not(.not-before):before {
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
            content: "";
            background-image: linear-gradient(90deg, rgba(211, 211, 211, 0) 0, rgb(236 236 236 / 80%) 50%, rgba(211, 211, 211, 0) 100%);
            background-size: 75% 100%;
            background-position: -200% 0;
            background-repeat: no-repeat;
            z-index: 99;
            /*animation: skeleton-ani 1.5s infinite;*/
            display: block;
            -webkit-animation: loading 1s infinite;
            animation: loading 1s infinite;
        }

        @-webkit-keyframes loading {
            to {
                background-position: 350% 0;
            }
        }

        @keyframes loading {
            to {
                background-position: 350% 0;
            }
        }

        /*dmä¸‹*/
        #foucus_day.skt-loading .skeleton:not(.not-before):before {
            background-image: linear-gradient(90deg, rgba(211, 211, 211, 0) 0, #1f1f1f 50%, rgba(211, 211, 211, 0) 100%);

        }

        #foucus_day.skt-loading .skeleton:after {
            background-color: #2b2b2b
        }
    </style>
    <h5 class="widget-title m-t-none"><a href="https://www.ihewro.com/cross.html?tag=41"
            class="highlightlink">ç•ªèŒ„é’Ÿ</a></h5>
    <div id="foucus_day" class="skt-loading">
        <div class="head_title"> ğŸ‰ ä»Šæ—¥ä¸“æ³¨ä¿¡æ¯</div>
        <button class="toggle-btn" id="toggleView">å‘¨è§†å›¾</button>
        <div class="HStack skeleton">
            <div class="metricBlock">
                <div class="title">â³ æ—¶é—´</div>
                <div class="value">7h20min</div>
                <div class="sub_value" style="color: red">â†‘20%</div>
            </div>
            <div class="metricBlock">
                <div class="title">ğŸ… ç•ªèŒ„</div>
                <div class="value">10ä¸ª</div>
                <div class="sub_value" style="color: #04B921">â†‘15%</div>
            </div>
            <div class="metricBlock">
                <div class="title">ğŸš¥ ä¸­æ–­</div>
                <div class="value">5æ¬¡</div>
                <div class="sub_value" style="color: red">â†“20%</div>
            </div>
        </div>
    </div>

    <script>
        // å½“å‰è§†å›¾æ¨¡å¼ï¼šday(æ—¥è§†å›¾) æˆ– week(å‘¨è§†å›¾)
        let currentView = 'day';
        let weekData = null;
        let dayData = null;

        // è·å–å¹¶æ˜¾ç¤ºæ•°æ®
        function fetchAndDisplayData() {
            var xhr = new XMLHttpRequest();
            const url = currentView === 'day'
                ? "http://localhost:8080/get_day_statistic?device_id=EC2CE75A-D92A-42EA-8C5D-DD5D4CD1F970"
                : "http://localhost:8080/get_week_statistic?device_id=EC2CE75A-D92A-42EA-8C5D-DD5D4CD1F970";

            xhr.open('GET', url, true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencode;charset=utf-8');
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var element = document.getElementsByClassName("skeleton")[0];
                    element.classList.remove("skeleton");

                    const data = JSON.parse(xhr.responseText).data;

                    if (currentView === 'week' && !weekData) {
                        weekData = data;
                    } else if (currentView === 'day' && !dayData) {
                        dayData = data;
                    }

                    updateUI(data);
                }
            };
            xhr.send();
        }

        // è®¡ç®—å‘¨è§†å›¾çš„åŠ¨æ€é«˜åº¦
        function calculateWeekViewHeight(metricsCount) {
            // åŸºç¡€é«˜åº¦åŒ…å«ï¼šé¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ(çº¦40px) + åº•éƒ¨é¡µè„š(çº¦30px) + ä¸Šä¸‹å†…è¾¹è·(24px)
            const baseHeight = 85;

            // æ¯ä¸ªæŒ‡æ ‡å—çš„é«˜åº¦(åŒ…å«æ ‡é¢˜ã€å€¼ã€å­å€¼å’Œè¾¹è·)
            const metricBlockHeight = 55;

            // æ¯è¡Œæœ€å¤šæ˜¾ç¤º3ä¸ªæŒ‡æ ‡å—
            const itemsPerRow = 3;

            // è®¡ç®—éœ€è¦å¤šå°‘è¡Œæ¥æ˜¾ç¤ºæ‰€æœ‰æŒ‡æ ‡
            const rowsNeeded = Math.ceil(metricsCount / itemsPerRow);

            // è®¡ç®—æ€»é«˜åº¦ = åŸºç¡€é«˜åº¦ + è¡Œæ•° * æ¯ä¸ªæŒ‡æ ‡å—é«˜åº¦
            return baseHeight + (rowsNeeded * metricBlockHeight);
        }

        // æ›´æ–°UIæ˜¾ç¤º
        function updateUI(data) {
            const root = document.getElementById('foucus_day');

            // æ›´æ–°æ ‡é¢˜å’Œé¡µè„š
            // root.getElementsByClassName("head_title")[0].innerHTML = data.title;
            // root.getElementsByClassName("footer")[0].innerHTML = data.footnote;

            // è·å–æŒ‡æ ‡å®¹å™¨
            const hstack = root.getElementsByClassName("HStack")[0];

            // å‘¨è§†å›¾æ¨¡å¼ä¸‹ï¼Œéœ€è¦é‡æ–°åˆ›å»ºæ‰€æœ‰æŒ‡æ ‡å—ä»¥æ˜¾ç¤ºå®Œæ•´çš„ä¸€å‘¨æ•°æ®
            if (currentView === 'week') {
                root.getElementsByClassName("head_title")[0].innerHTML = "æœ¬å‘¨ä¸“æ³¨ä¿¡æ¯";

                // æ¸…ç©ºç°æœ‰çš„æŒ‡æ ‡å—
                hstack.innerHTML = '';

                // ä¸ºæ¯ä¸ªæŒ‡æ ‡åˆ›å»ºä¸€ä¸ªå—
                if (data.metrics && data.metrics.length > 0) {
                    data.metrics.forEach(function (metric) {
                        // åˆ›å»ºæ–°çš„æŒ‡æ ‡å—
                        const metricBlock = document.createElement('div');
                        metricBlock.className = 'metricBlock';

                        // åˆ›å»ºæ ‡é¢˜
                        const title = document.createElement('div');
                        title.className = 'title';
                        title.innerHTML = metric.title;

                        // åˆ›å»ºå€¼
                        const value = document.createElement('div');
                        value.className = 'value';
                        value.innerHTML = metric.value;

                        // åˆ›å»ºå­å€¼
                        const subValue = document.createElement('div');
                        subValue.className = 'sub_value';
                        subValue.innerHTML = metric.subValue;
                        subValue.style.color = metric.subValueColor;

                        // ç»„è£…æŒ‡æ ‡å—
                        metricBlock.appendChild(title);
                        metricBlock.appendChild(value);
                        metricBlock.appendChild(subValue);

                        // æ·»åŠ åˆ°å®¹å™¨
                        hstack.appendChild(metricBlock);
                    });

                    // æ ¹æ®æŒ‡æ ‡æ•°é‡åŠ¨æ€è®¾ç½®å¡ç‰‡é«˜åº¦
                    if (currentView === 'week') {
                        const dynamicHeight = calculateWeekViewHeight(data.metrics.length);
                        root.style.height = dynamicHeight + 'px';
                    }
                }
            } else {
                const root = document.getElementById('foucus_day');
                root.getElementsByClassName("head_title")[0].innerHTML = "ä»Šæ—¥ä¸“æ³¨ä¿¡æ¯";
                // æ—¥è§†å›¾æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨å›ºå®šçš„ä¸‰ä¸ªæŒ‡æ ‡å—
                const els = root.getElementsByClassName("metricBlock");
                Array.prototype.forEach.call(els, function (el, index) {
                    if (data.metrics && data.metrics[index]) {
                        el.getElementsByClassName("title")[0].innerHTML = data.metrics[index].title;
                        el.getElementsByClassName("value")[0].innerHTML = data.metrics[index].value;
                        el.getElementsByClassName("sub_value")[0].innerHTML = data.metrics[index].subValue;
                        el.getElementsByClassName("sub_value")[0].style.color = data.metrics[index].subValueColor;
                    }
                });
                root.style.height = 'auto';

            }
        }

        // åˆ‡æ¢è§†å›¾
        document.getElementById('toggleView').addEventListener('click', function () {
            if (currentView === 'day') {
                currentView = 'week';
                this.textContent = 'æ—¥è§†å›¾';
                // åˆ‡æ¢åˆ°å‘¨è§†å›¾æ—¶æ·»åŠ ç±»å
                document.getElementById('foucus_day').classList.add('week-view');
                // å¦‚æœå·²ç»æœ‰å‘¨æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨å¹¶è®¡ç®—é«˜åº¦ï¼Œå¦åˆ™è·å–
                if (weekData) {
                    updateUI(weekData);
                    // ç¡®ä¿åœ¨ä½¿ç”¨ç¼“å­˜æ•°æ®æ—¶ä¹Ÿåº”ç”¨åŠ¨æ€é«˜åº¦
                    const dynamicHeight = calculateWeekViewHeight(weekData.metrics.length);
                    document.getElementById('foucus_day').style.height = dynamicHeight + 'px';
                } else {
                    // æ·»åŠ éª¨æ¶å±æ•ˆæœ
                    document.getElementsByClassName("HStack")[0].classList.add("skeleton");
                    fetchAndDisplayData();
                }
            } else {
                currentView = 'day';
                this.textContent = 'å‘¨è§†å›¾';
                // åˆ‡æ¢å›æ—¥è§†å›¾æ—¶æ¢å¤å¡ç‰‡é«˜åº¦
                document.getElementById('foucus_day').classList.remove('week-view');
                document.getElementById('foucus_day').style.height = 'auto';
                // é‡ç½®ä¸ºæ—¥è§†å›¾çš„é»˜è®¤ç»“æ„
                const hstack = document.getElementsByClassName("HStack")[0];
                hstack.innerHTML = `
                        <div class="metricBlock">
                            <div class="title">â³ æ—¶é—´</div>
                            <div class="value">7h20min</div>
                            <div class="sub_value" style="color: red">â†‘20%</div>
                        </div>
                        <div class="metricBlock">
                            <div class="title">ğŸ… ç•ªèŒ„</div>
                            <div class="value">10ä¸ª</div>
                            <div class="sub_value" style="color: #04B921">â†‘15%</div>
                        </div>
                        <div class="metricBlock">
                            <div class="title">ğŸš¥ ä¸­æ–­</div>
                            <div class="value">5æ¬¡</div>
                            <div class="sub_value" style="color: red">â†“20%</div>
                        </div>
                    `;
                if (dayData) {
                    updateUI(dayData);
                } else {
                    // æ·»åŠ éª¨æ¶å±æ•ˆæœ
                    document.getElementsByClassName("HStack")[0].classList.add("skeleton");

                    fetchAndDisplayData();
                }
            }
        });

        // åˆå§‹åŠ è½½
        fetchAndDisplayData();

        // ç¡®ä¿åˆå§‹çŠ¶æ€ä¸‹è§†å›¾æ¨¡å¼æ­£ç¡®
        if (currentView === 'day') {
            document.getElementById('foucus_day').classList.remove('week-view');
        } else {
            document.getElementById('foucus_day').classList.add('week-view');
        }
    </script>