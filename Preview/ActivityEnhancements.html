<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ActivityStatsView UI 增强说明</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 24px; line-height: 1.6; }
    h1, h2 { margin: 0.3em 0; }
    code { background: #f5f5f5; padding: 2px 6px; border-radius: 4px; }
    .tag { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; }
    .blue { color: #0b5fff; background: rgba(11,95,255,0.1); }
    .orange { color: #ff7f0e; background: rgba(255,127,14,0.12); }
    .gray { color: #6b7280; background: rgba(107,114,128,0.15); }
    .panel { border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin: 16px 0; }
    .row { display: flex; align-items: center; gap: 8px; }
    .bar { height: 8px; border-radius: 4px; background: #e5e7eb; overflow: hidden; }
    .bar > div { height: 100%; background: #0b5fff; }
  </style>
  </head>
<body>
  <h1>ActivityStatsView UI 增强说明</h1>
  <p>该页面用于说明最近对 <code>ActivityStatsView.swift</code> 的增强：支持 App 图标、类别标签与 Top Apps 行的百分比展示，并新增标签点击交互。</p>

  <h2>组件说明</h2>
  <div class="panel">
    <ul>
      <li>
        <strong>AppBadge（应用徽标）</strong>
        <ul>
          <li>在 macOS 上尝试通过 <code>NSWorkspace</code> 获取真实图标；找不到时使用字母徽标作为回退。</li>
        </ul>
      </li>
      <li>
        <strong>CategoryTag（类别标签）</strong>
        <ul>
          <li>类别仅分为三种：<em>生产力</em>、<em>娱乐</em>、<em>其他</em>，与设置页定义一致。</li>
          <li>交互：点击标签会弹出菜单，可直接修改为“生产力 / 娱乐 / 其他”。修改后立即保存到分类配置。</li>
          <li>UI 说明：不使用系统下拉菜单（Menu），而采用轻量级 <code>popover</code> 弹出菜单，保持标签外观不变。</li>
          <li>颜色映射：生产力（蓝色）、娱乐（橙色）、其他（灰色）。</li>
        </ul>
      </li>
      <li>
        <strong>TopAppRow（Top Apps 行）</strong>
        <ul>
          <li>显示应用名、类别标签以及相对使用占比的进度条。</li>
          <li>占比计算：<code>usageTime / totalActiveTime</code>。</li>
        </ul>
      </li>
    </ul>
  </div>

  <h2>示例预览（静态示意）</h2>
  <div class="panel">
    <div class="row">
      <span class="tag blue">生产力</span>
      <span>Visual Studio Code</span>
    </div>
    <div class="bar" style="width: 280px; margin-top: 8px;">
      <div style="width: 56%;"></div>
    </div>

    <div class="row" style="margin-top: 14px;">
      <span class="tag orange">娱乐</span>
      <span>Chrome</span>
    </div>
    <div class="bar" style="width: 280px; margin-top: 8px;">
      <div style="width: 28%; background:#ff7f0e;"></div>
    </div>

    <div class="row" style="margin-top: 14px;">
      <span class="tag gray">其他</span>
      <span>Unknown App</span>
    </div>
    <div class="bar" style="width: 280px; margin-top: 8px;">
      <div style="width: 16%; background:#6b7280;"></div>
    </div>
  </div>

  <h2>用户交互与持久化</h2>
  <ul>
    <li>点击类别标签弹出菜单，选择后即刻通过 <code>AppCategoryManager</code> 写入（添加或移除）并保存到 <code>UserDefaults</code>。</li>
    <li>分类判断：<code>isProductiveApp</code> / <code>isEntertainmentApp</code>；都不是时显示为“其他”。</li>
    <li>刷新机制优化：将 <code>AppCategoryManager</code> 以 <code>.environmentObject</code> 注入到行组件（RecentEventRow/TopAppRow），使其订阅 <code>@Published</code> 的分类列表变化，选择后标签即时刷新。</li>
  </ul>

  <p>如需进一步支持按 Bundle ID 分类或显示真实图标，可将 <code>SystemEvent.data["bundle_id"]</code> 接入到行组件。</p>
  <p>最后更新：<script>document.write(new Date().toLocaleString())</script></p>
</body>
</html>